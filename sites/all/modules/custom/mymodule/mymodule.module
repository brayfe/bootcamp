<?php
/**
 * @file
 * The UT Drupal Bootcamp module.
 *
 * Francine demonstrates various elements of building a form.
 */

define('MYMODULE_ALLOWED_ROLE', 'administrator');

/**
 * Implements hook_form_alter().
 */
function mymodule_form_alter(&$form, &$form_state, $form_id) {
  global $user;
  // Check that we are editing a Landing Page or Standard Page Node.
  if ($form_id == 'landing_page_node_form' || $form_id == 'standard_page_node_form') {
    // If user doesn't have allowed role, modify description and disable photo upload.
    if (!in_array(MYMODULE_ALLOWED_ROLE, $user->roles)) {
      // Disable entire photo field.
      $form['field_utexas_hero_photo'][LANGUAGE_NONE][0]['#disabled'] = TRUE;
      $form['field_utexas_hero_photo'][LANGUAGE_NONE][0]['utexas_hero_photo_image']['#process'] = array('mymodule_image_upload_process');
      $form['field_utexas_hero_photo']['#prefix'] = "<H2>Hero images may only be added by site administrators.</H2>";
    }
  }
}

/**
 * Custom function callback to disable the image upload button.
 */
function mymodule_image_upload_process($element, &$form_state, $form) {
  if (!isset($element['#progress_message'])) {
    $element['#progress_message'] = NULL;
  }
  $element = file_managed_file_process($element, $form_state, $form);
  $element['upload_button']['#disabled'] = TRUE;

  return $element;
}
